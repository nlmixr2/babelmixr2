<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running Monolix • babelmixr2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running Monolix">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">babelmixr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/new-estimation.html">Creating a New Estimation Method</a></li>
    <li><a class="dropdown-item" href="../articles/PopED.html">PopED</a></li>
    <li><a class="dropdown-item" href="../articles/running-monlix.html">Running Monolix</a></li>
    <li><a class="dropdown-item" href="../articles/running-nonmem.html">Running NONMEM with nlmixr2</a></li>
    <li><a class="dropdown-item" href="../articles/running-pknca.html">Obtain initial estimates and unit conversions with PKNCA</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nlmixr2/babelmixr2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Running Monolix</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/babelmixr2/blob/v0.1.7/vignettes/articles/running-monlix.Rmd" class="external-link"><code>vignettes/articles/running-monlix.Rmd</code></a></small>
      <div class="d-none name"><code>running-monlix.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="step-0-what-do-you-need-to-do-to-have-nlmixr2-run-monolix-from-a-nlmixr2-model">Step 0: What do you need to do to have <code>nlmixr2</code> run
<code>Monolix</code> from a nlmixr2 model<a class="anchor" aria-label="anchor" href="#step-0-what-do-you-need-to-do-to-have-nlmixr2-run-monolix-from-a-nlmixr2-model"></a>
</h2>
<p>To use <code>Monolix</code> with nlmixr2, you do not need to change
your data or your <code>nlmixr2</code> dataset. <code>babelmixr2</code>
will do the heavy lifting here.</p>
<p>You do need to setup how to run <code>Monolix</code>. If you have
setup the <code>lixoftConnectors</code> package from Monolix, no further
setup is needed. Instead if you run <code>Monolix</code> from the
command line for grid processing (for example) you can figure out the
command to run <code>Monolix</code> (it is often useful to use the full
command path and set it in the options, ie
<code>options("babelmixr2.monolix"="monolix")</code> or use
<code>monolixControl(runCommand="monolix")</code>. If needed, I prefer
the <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> method since you only need to set it once.
This could also be a function if you prefer (but I will not cover using
the function here).</p>
</div>
<div class="section level2">
<h2 id="step-1-run-a-nlmixr2-in-monolix">Step 1: Run a <code>nlmixr2</code> in Monolix<a class="anchor" aria-label="anchor" href="#step-1-run-a-nlmixr2-in-monolix"></a>
</h2>
<p>Lets take the classic warfarin example. The model we use in the
<code>nlmixr2</code> vignettes is:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pk.turnover.emax3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">tktr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">tka</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">tcl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="va">tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="va">eta.ktr</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>    <span class="va">eta.ka</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>    <span class="va">eta.cl</span> <span class="op">~</span> <span class="fl">2</span></span>
<span>    <span class="va">eta.v</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>    <span class="va">prop.err</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span>    <span class="va">pkadd.err</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="va">temax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/logit.html" class="external-link">logit</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span></span>
<span>    <span class="va">tec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="va">tkout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span></span>
<span>    <span class="va">te0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="va">eta.emax</span> <span class="op">~</span> <span class="fl">.5</span></span>
<span>    <span class="va">eta.ec50</span>  <span class="op">~</span> <span class="fl">.5</span></span>
<span>    <span class="va">eta.kout</span> <span class="op">~</span> <span class="fl">.5</span></span>
<span>    <span class="va">eta.e0</span> <span class="op">~</span> <span class="fl">.5</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="va">pdadd.err</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">ktr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tktr</span> <span class="op">+</span> <span class="va">eta.ktr</span><span class="op">)</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tka</span> <span class="op">+</span> <span class="va">eta.ka</span><span class="op">)</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tcl</span> <span class="op">+</span> <span class="va">eta.cl</span><span class="op">)</span></span>
<span>    <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tv</span> <span class="op">+</span> <span class="va">eta.v</span><span class="op">)</span></span>
<span>    <span class="va">emax</span> <span class="op">=</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/logit.html" class="external-link">expit</a></span><span class="op">(</span><span class="va">temax</span><span class="op">+</span><span class="va">eta.emax</span><span class="op">)</span></span>
<span>    <span class="va">ec50</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tec50</span> <span class="op">+</span> <span class="va">eta.ec50</span><span class="op">)</span></span>
<span>    <span class="va">kout</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tkout</span> <span class="op">+</span> <span class="va">eta.kout</span><span class="op">)</span></span>
<span>    <span class="va">e0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">te0</span> <span class="op">+</span> <span class="va">eta.e0</span><span class="op">)</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="va">DCP</span> <span class="op">=</span> <span class="va">center</span><span class="op">/</span><span class="va">v</span></span>
<span>    <span class="va">PD</span><span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="va">emax</span><span class="op">*</span><span class="va">DCP</span><span class="op">/</span><span class="op">(</span><span class="va">ec50</span><span class="op">+</span><span class="va">DCP</span><span class="op">)</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="fu">effect</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="va">e0</span></span>
<span>    <span class="va">kin</span> <span class="op">=</span> <span class="va">e0</span><span class="op">*</span><span class="va">kout</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">=</span> <span class="op">-</span><span class="va">ktr</span> <span class="op">*</span> <span class="va">depot</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">gut</span><span class="op">)</span> <span class="op">=</span>  <span class="va">ktr</span> <span class="op">*</span> <span class="va">depot</span> <span class="op">-</span><span class="va">ka</span> <span class="op">*</span> <span class="va">gut</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">center</span><span class="op">)</span> <span class="op">=</span>  <span class="va">ka</span> <span class="op">*</span> <span class="va">gut</span> <span class="op">-</span> <span class="va">cl</span> <span class="op">/</span> <span class="va">v</span> <span class="op">*</span> <span class="va">center</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">effect</span><span class="op">)</span> <span class="op">=</span> <span class="va">kin</span><span class="op">*</span><span class="va">PD</span> <span class="op">-</span><span class="va">kout</span><span class="op">*</span><span class="va">effect</span></span>
<span>    <span class="co">##</span></span>
<span>    <span class="va">cp</span> <span class="op">=</span> <span class="va">center</span> <span class="op">/</span> <span class="va">v</span></span>
<span>    <span class="va">cp</span> <span class="op">~</span> <span class="fu">prop</span><span class="op">(</span><span class="va">prop.err</span><span class="op">)</span> <span class="op">+</span> <span class="fu">add</span><span class="op">(</span><span class="va">pkadd.err</span><span class="op">)</span></span>
<span>    <span class="va">effect</span> <span class="op">~</span> <span class="fu">add</span><span class="op">(</span><span class="va">pdadd.err</span><span class="op">)</span> <span class="op">|</span> <span class="va">pca</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once monolix is run, you can run the <code>nlmixr2</code> model using
<code>Monolix</code> as if it is new estimation method:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlmixr2.html" class="external-link">nlmixr</a></span><span class="op">(</span><span class="va">pk.turnover.emax3</span>, <span class="fu">nlmixr2data</span><span class="fu">::</span><span class="va"><a href="https://nlmixr2.github.io/nlmixr2data/reference/warfarin.html" class="external-link">warfarin</a></span>, <span class="st">"monolix"</span>,</span>
<span>                              <span class="fu"><a href="../reference/monolixControl.html">monolixControl</a></span><span class="op">(</span>modelName<span class="op">=</span><span class="st">"pk.turnover.emax3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> parameter labels from comments are typically ignored in non-interactive mode</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Need to run with the source intact to parse comments</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> assuming monolix is running because 'pk.turnover.emax3-monolix.txt' is present</span></span>
<span><span class="co">#&gt; → loading into <span style="color: #0000BB;">symengine</span> environment...</span></span>
<span><span class="co">#&gt; → pruning branches (`if`/`else`) of full model...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → compiling EBE model...</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → Calculating residuals/tables</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → compress origData in nlmixr2 object, save 27560</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> monolix parameter history needs exported charts, please export charts</span></span></code></pre></div>
<p>This fit issues an informational tidbit -</p>
<ul>
<li>monolix parameter history needs exported charts, please export
charts</li>
</ul>
<p>This will automatically be generated as well when
<code>lixoftConnectors</code> package is generated and you have a recent
version of Monolix. If you don’t have that information then the
important parameter history plots will not be imported and you cannot
see those plots.</p>
<p>Just like with the NONMEM translation, the
<code><a href="../reference/monolixControl.html">monolixControl()</a></code> has <code>modelName</code> which helps
control the output directory of <code>Monolix</code> (if not specified
<code>babelmixr2</code> tries to guess based on the model name based on
the input).</p>
<p>Printing this out this <code>nlmixr2</code> fit you see:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── </span><span style="color: #0000BB; font-weight: bold;">nlmix</span><span style="color: #BB0000; font-weight: bold;">r²</span><span style="font-weight: bold;"> </span><span style="color: #BBBB00; font-weight: bold;">monolix</span><span style="font-weight: bold;"> ver 2021R1 ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              OBJF      AIC      BIC Log-likelihood Condition#(Cov)</span></span>
<span><span class="co">#&gt; monolix  1522.704 2448.398 2527.819      -1205.199        2203.836</span></span>
<span><span class="co">#&gt;          Condition#(Cor)</span></span>
<span><span class="co">#&gt; monolix         2.697324</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Time (sec </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$time</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          setup table compress  other</span></span>
<span><span class="co">#&gt; elapsed 0.0028 0.135    0.006 4.3712</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Population Parameters (</span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$parFixed</span><span style="font-weight: bold;"> or </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$parFixedDf</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              <span style="font-weight: bold;">Est.</span>     <span style="font-weight: bold;">SE</span>     <span style="font-weight: bold;">%RSE</span> <span style="font-weight: bold;">Back-transformed(95%CI)</span> <span style="font-weight: bold;">BSV(CV% or SD)</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tktr</span>        0.218  0.179       82      1.24 (0.876, 1.77)           84.0</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tka</span>       0.00533  0.117 2.19e+03        1.01 (0.8, 1.26)           48.6</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tcl</span>         -2.01 0.0518     2.58    0.135 (0.122, 0.149)           28.5</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tv</span>           2.04 0.0438     2.14       7.73 (7.09, 8.42)           22.6</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">prop.err</span>   0.0986                                  0.0986               </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">pkadd.err</span>   0.533                                   0.533               </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">temax</span>        4.46  0.527     11.8    0.989 (0.969, 0.996)          0.380</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tec50</span>      0.0786 0.0889      113      1.08 (0.909, 1.29)           47.8</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tkout</span>       -2.94 0.0261    0.888  0.053 (0.0503, 0.0558)           7.87</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">te0</span>          4.57 0.0114    0.249       96.7 (94.5, 98.9)           5.08</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">pdadd.err</span>    3.79                                    3.79               </span></span>
<span><span class="co">#&gt;           <span style="font-weight: bold;">Shrink(SD)%</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tktr</span>           <span style="color: #BB0000; font-weight: bold;">47.9%</span> </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tka</span>            <span style="color: #BB0000; font-weight: bold;">48.9%</span> </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tcl</span>            1.25% </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tv</span>             6.09% </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">prop.err</span>             </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">pkadd.err</span>            </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">temax</span>          <span style="color: #BB0000; font-weight: bold;">91.9%</span> </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tec50</span>          6.29% </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tkout</span>          <span style="color: #BB0000; font-weight: bold;">36.6%</span> </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">te0</span>            19.9% </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">pdadd.err</span>            </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;   Covariance Type (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$covMethod</span>): <span style="font-weight: bold;">MonolixLin</span></span></span>
<span><span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span></span>
<span><span class="co">#&gt;   Full BSV covariance (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$omega</span>) or correlation (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$omegaR</span>; diagonals=SDs) </span></span>
<span><span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in <span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$shrink</span> </span></span>
<span><span class="co">#&gt;   Censoring (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$censInformation</span>): No censoring</span></span>
<span><span class="co">#&gt;   Minimization message (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$message</span>):  </span></span>
<span><span class="co">#&gt;     IPRED relative difference compared to Monolix IPRED: 0.09%; 95% percentile: (0.01%,0.49%); rtol=0.000941</span></span>
<span><span class="co">#&gt;     PRED relative difference compared to Monolix PRED: 0.04%; 95% percentile: (0%,0.2%); rtol=0.000428</span></span>
<span><span class="co">#&gt;     IPRED absolute difference compared to Monolix IPRED: atol=0.00911; 95% percentile: (0.000493, 0.0928)</span></span>
<span><span class="co">#&gt;     PRED absolute difference compared to Monolix PRED: atol=0.000428; 95% percentile: (3.14e-07, 0.203)</span></span>
<span><span class="co">#&gt;     monolix model: 'pk.turnover.emax3-monolix.mlxtran' </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Fit Data (object </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="font-weight: bold;"> is a modified </span><span style="color: #0000BB; font-weight: bold;">tibble</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 483 × 35</span></span></span>
<span><span class="co">#&gt;   ID     TIME CMT      DV  PRED   RES IPRED   IRES  IWRES eta.ktr eta.ka eta.cl</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       0.5 cp      0    1.40 -<span style="color: #BB0000;">1.40</span> 0.500 -<span style="color: #BB0000;">0.500</span> -<span style="color: #BB0000;">0.934</span>  -<span style="color: #BB0000;">0.638</span> -<span style="color: #BB0000;">0.447</span>  0.689</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1       1   cp      1.9  3.94 -<span style="color: #BB0000;">2.04</span> 1.62   0.284  0.511  -<span style="color: #BB0000;">0.638</span> -<span style="color: #BB0000;">0.447</span>  0.689</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1       2   cp      3.3  8.30 -<span style="color: #BB0000;">5.00</span> 4.29  -<span style="color: #BB0000;">0.987</span> -<span style="color: #BB0000;">1.45</span>   -<span style="color: #BB0000;">0.638</span> -<span style="color: #BB0000;">0.447</span>  0.689</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 480 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 23 more variables: eta.v &lt;dbl&gt;, eta.emax &lt;dbl&gt;, eta.ec50 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   eta.kout &lt;dbl&gt;, eta.e0 &lt;dbl&gt;, cp &lt;dbl&gt;, depot &lt;dbl&gt;, gut &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   center &lt;dbl&gt;, effect &lt;dbl&gt;, ktr &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   emax &lt;dbl&gt;, ec50 &lt;dbl&gt;, kout &lt;dbl&gt;, e0 &lt;dbl&gt;, DCP &lt;dbl&gt;, PD &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   kin &lt;dbl&gt;, tad &lt;dbl&gt;, dosenum &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Of particular interest is the comparison between Monolix predictions
and nlmixr predictions. In this case, I believe that these also imply
the models are predicting the same thing. Note that the model
predictions are not as close as they were with <a href="https://nlmixr2.github.io/babelmixr2/articles/running-nonmem.html">NONMEM</a>
because Monolix does not use the <code>lsoda</code> ODE solver. Hence
this small deviation is expected, but still gives a validated Monolix
model.</p>
</div>
<div class="section level2">
<h2 id="optional-step-2-add-conditional-weighted-residualsfocei-objf-to-monolix">Optional Step 2: Add conditional weighted residuals/focei objf to
Monolix<a class="anchor" aria-label="anchor" href="#optional-step-2-add-conditional-weighted-residualsfocei-objf-to-monolix"></a>
</h2>
<p>As in the case of <code>NONMEM</code>, this gives some things that
are not available to Monolix, like adding conditional weighted
residuals:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/nlmixr2/reference/addCwres.html" class="external-link">addCwres</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; → loading into <span style="color: #0000BB;">symengine</span> environment...</span></span>
<span><span class="co">#&gt; → pruning branches (`if`/`else`) of full model...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → calculate jacobian</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → calculate sensitivities</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → calculate ∂(f)/∂(η)</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → calculate ∂(R²)/∂(η)</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in inner model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in inner model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → compiling inner model...</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in FD model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in FD model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → compiling EBE model...</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → compiling events FD model...</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → Calculating residuals/tables</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span></code></pre></div>
<p>Which will add nlmixr’s CWRES as well as adding the nlmixr2
<code>FOCEi</code> objective function</p>
<p>Because you now have an objective function compared based on the same
assumptions, you could compare the performance of Monolix and NONMEM
based on objective function.</p>
<p>To be fair, objective function values must always be used with
caution. How the model performs and predicts the data is far more
valuable.</p>
</div>
<div class="section level2">
<h2 id="optional-step-3-use-nlmixr2-for-vpc-reporting-etc-">Optional Step 3: Use nlmixr2 for vpc, reporting, etc.<a class="anchor" aria-label="anchor" href="#optional-step-3-use-nlmixr2-for-vpc-reporting-etc-"></a>
</h2>
<p>Also since it is a <code>nlmixr2</code> object it would be easy to
perform a VPC too:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v1s</span> <span class="op">&lt;-</span> <span class="fu">vpcPlot</span><span class="op">(</span><span class="va">fit</span>, show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>obs_dv<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Warfarin Cp [mg/L] or PCA"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time [h]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span></span>
<span><span class="va">v2s</span> <span class="op">&lt;-</span> <span class="fu">vpcPlot</span><span class="op">(</span><span class="va">fit</span>, show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>obs_dv<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, pred_corr <span class="op">=</span> <span class="cn">TRUE</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Prediction Corrected Warfarin Cp [mg/L] or PCA"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time [h]"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">v1s</span></span></code></pre></div>
<p><img src="running-monlix_files/figure-html/vpc-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">v2s</span></span></code></pre></div>
<p><img src="running-monlix_files/figure-html/vpc-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="notes-about-monolix-data-translation">Notes about Monolix data translation<a class="anchor" aria-label="anchor" href="#notes-about-monolix-data-translation"></a>
</h2>
<p>The input dataset expected to be compatible with <code>rxode2</code>
or <code>nlmixr2</code>. This dataset is then converted to Monolix
format:</p>
<ul>
<li><p>The combination of <code>CMT</code> and Dose type creates a
unique <code>ADM</code> variable.</p></li>
<li><p>The <code>ADM</code> definition is saved in the monolix model
file</p></li>
<li><p><code>babelmixr2</code> creates a macro describing the
compartment, ie
<code>compartment(cmt=#, amount=stateName)</code></p></li>
<li>
<p><code>babelmixr2</code> also creates a macro for each type of
dosing:</p>
<ul>
<li><p>Bolus/infusion uses <code>depot()</code> and adds modeled lag
time (<code>Tlag</code>) or bioavailability (<code>p</code>) if
specified</p></li>
<li><p>Modeled rate uses <code>depot()</code> with
<code>Tk0=amtDose/rate</code>. <code>babelmixr2</code> also adds modeled
lag time (<code>Tlag</code>) or bioavailability (<code>p</code>) if
specified</p></li>
<li><p>Modeled duration uses <code>depot()</code> with
<code>Tk0=dur</code>, also add adds modeled lag time (<code>Tlag</code>)
or bioavailability (<code>p</code>) if specified Turning off a
compartment uses empty macro</p></li>
</ul>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Fidler, Bill Denney.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
