<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Obtain initial estimates and unit conversions with PKNCA • babelmixr2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Obtain initial estimates and unit conversions with PKNCA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">babelmixr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/new-estimation.html">Creating a New Estimation Method</a></li>
    <li><a class="dropdown-item" href="../articles/PopED.html">PopED</a></li>
    <li><a class="dropdown-item" href="../articles/running-monlix.html">Running Monolix</a></li>
    <li><a class="dropdown-item" href="../articles/running-nonmem.html">Running NONMEM with nlmixr2</a></li>
    <li><a class="dropdown-item" href="../articles/running-pknca.html">Obtain initial estimates and unit conversions with PKNCA</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nlmixr2/babelmixr2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Obtain initial estimates and unit conversions with PKNCA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/babelmixr2/blob/main/vignettes/articles/running-pknca.Rmd" class="external-link"><code>vignettes/articles/running-pknca.Rmd</code></a></small>
      <div class="d-none name"><code>running-pknca.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Initial estimates for a compartmental population PK model can be
obtained using <code>babelmixr2</code> with the <code>"pknca"</code>
estimation method. Also, the central compartment scaling factor can be
auto-generated based on units for dosing, concentration measurement,
desired volume of distribution units, and time.</p>
<p>You do not need to perform NCA analysis by hand; the
<code>"pknca"</code> estimation method will perform NCA analysis using
the <a href="https://billdenney.github.io/pknca/" class="external-link">PKNCA</a> package
automatically.</p>
<p>The methods used for converting NCA calculations to parameter
estimates are described in the help for
<code><a href="../reference/nlmixr2Est.pknca.html">nlmixr2Est.pknca()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="initial-example">Initial example<a class="anchor" aria-label="anchor" href="#initial-example"></a>
</h2>
<p>Initial model setup is the same as for any other <code>nlmixr2</code>
model. You must load the <code>babelmixr2</code> library so that the
<code><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlmixr2.html" class="external-link">nlmixr()</a></code> function recognizes
<code>est = "pknca"</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/babelmixr2/">babelmixr2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nlmixr2</span></span>
<span><span class="co">#&gt; Loading required package: nlmixr2data</span></span>
<span><span class="va">one.compartment</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">tka</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.57</span><span class="op">)</span>; <span class="fu">label</span><span class="op">(</span><span class="st">"Ka (1/hr)"</span><span class="op">)</span></span>
<span>    <span class="va">tcl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2.72</span><span class="op">)</span>; <span class="fu">label</span><span class="op">(</span><span class="st">"Cl (L/hr)"</span><span class="op">)</span></span>
<span>    <span class="va">tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">31.5</span><span class="op">)</span>; <span class="fu">label</span><span class="op">(</span><span class="st">"V (L)"</span><span class="op">)</span></span>
<span>    <span class="va">eta.ka</span> <span class="op">~</span> <span class="fl">0.6</span></span>
<span>    <span class="va">eta.cl</span> <span class="op">~</span> <span class="fl">0.3</span></span>
<span>    <span class="va">eta.v</span> <span class="op">~</span> <span class="fl">0.1</span></span>
<span>    <span class="va">add.sd</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>; <span class="fu">label</span><span class="op">(</span><span class="st">"additive residual error (mg/L)"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co"># and a model block with the error specification and model specification</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tka</span> <span class="op">+</span> <span class="va">eta.ka</span><span class="op">)</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tcl</span> <span class="op">+</span> <span class="va">eta.cl</span><span class="op">)</span></span>
<span>    <span class="va">vc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tv</span> <span class="op">+</span> <span class="va">eta.v</span><span class="op">)</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">ka</span> <span class="op">*</span> <span class="va">depot</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">center</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ka</span> <span class="op">*</span> <span class="va">depot</span> <span class="op">-</span> <span class="va">cl</span> <span class="op">/</span> <span class="va">vc</span> <span class="op">*</span> <span class="va">center</span></span>
<span>    <span class="va">cp</span> <span class="op">&lt;-</span> <span class="va">center</span> <span class="op">/</span> <span class="va">vc</span></span>
<span>    <span class="va">cp</span> <span class="op">~</span> <span class="fu">add</span><span class="op">(</span><span class="va">add.sd</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To use PKNCA to get initial estimates, use <code>est = "pknca"</code>
instead of one of the other <code>nlmixr2</code> estimation methods.</p>
<p>For unit conversions, provide the units to the
<code>control = pkncaControl()</code> argument. Unit conversions are
only supported when the units can be automatically converted;
mass/volume can be converted to any other mass/volume ratio, but mass to
molar or molar to mass cannot because there is not a single
mass-to-molar conversion factor.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepared</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/nlmixr2/reference/nlmixr2.html" class="external-link">nlmixr2</a></span><span class="op">(</span></span>
<span>    <span class="va">one.compartment</span>,</span>
<span>    data <span class="op">=</span> <span class="va">theo_sd</span>,</span>
<span>    est <span class="op">=</span> <span class="st">"pknca"</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="../reference/pkncaControl.html">pkncaControl</a></span><span class="op">(</span>concu <span class="op">=</span> <span class="st">"ng/mL"</span>, doseu <span class="op">=</span> <span class="st">"mg"</span>, timeu <span class="op">=</span> <span class="st">"hr"</span>, volumeu <span class="op">=</span> <span class="st">"L"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> parameter labels from comments are typically ignored in non-interactive mode</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Need to run with the source intact to parse comments</span></span>
<span><span class="co">#&gt; Loading required namespace: testthat</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate (0.89314878960486) and upper/lower bound (-3.50655789731998 to 3.72508541597241) of `tka`</span></span>
<span><span class="co">#&gt; → significant model change detected</span></span>
<span><span class="co">#&gt; → removed from model: '$getSplitModel'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate (8.41044546236311) and upper/lower bound (5.51439905878865 to 10.899462850803) of `tcl`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate (10.5377244826318) and upper/lower bound (7.94567233496473 to 13.1050053785005) of `tv`</span></span></code></pre></div>
<p>Now, you have the prepared model with updated initial estimates and
the NCA results embedded. You can see the new model and the PKNCA
estimates by looking at the <code>prepared$ui</code> (the model as
interpreted by rxode2) and <code>prepared$nca</code> (the PKNCAresults
object).</p>
<p>Note that in the new model, the fixed effect initial estimates are
changed from their original values. The residual error and
between-subject variability are unchanged.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepared</span><span class="op">$</span><span class="va">ui</span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">rxode2-based free-form 2-cmt ODE model</span> <span style="color: #00BBBB;">──────────────────────────────────────</span> </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Initalization:</span> ──  </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Fixed Effects</span> (<span style="color: #0000BB; font-weight: bold;">$theta</span>): </span></span>
<span><span class="co">#&gt;        tka        tcl         tv     add.sd </span></span>
<span><span class="co">#&gt;  0.8931488  8.4104455 10.5377245  0.7000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Omega</span> (<span style="color: #0000BB; font-weight: bold;">$omega</span>): </span></span>
<span><span class="co">#&gt;        eta.ka eta.cl eta.v</span></span>
<span><span class="co">#&gt; eta.ka    0.6    0.0   0.0</span></span>
<span><span class="co">#&gt; eta.cl    0.0    0.3   0.0</span></span>
<span><span class="co">#&gt; eta.v     0.0    0.0   0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; States</span> (<span style="color: #0000BB; font-weight: bold;">$state</span> or <span style="color: #0000BB; font-weight: bold;">$stateDf</span>): </span></span>
<span><span class="co">#&gt;   Compartment Number Compartment Name</span></span>
<span><span class="co">#&gt; 1                  1            depot</span></span>
<span><span class="co">#&gt; 2                  2           center</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">μ-referencing (</span><span style="color: #0000BB; font-weight: bold;">$muRefTable</span><span style="font-weight: bold;">):</span> ──  </span></span>
<span><span class="co">#&gt;   theta    eta level</span></span>
<span><span class="co">#&gt; 1   tka eta.ka    id</span></span>
<span><span class="co">#&gt; 2   tcl eta.cl    id</span></span>
<span><span class="co">#&gt; 3    tv  eta.v    id</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Model (Normalized Syntax):</span> ── </span></span>
<span><span class="co">#&gt; function() {</span></span>
<span><span class="co">#&gt;     ini({</span></span>
<span><span class="co">#&gt;         tka &lt;- c(-3.50655789731998, 0.89314878960486, 3.72508541597241)</span></span>
<span><span class="co">#&gt;         label("Ka (1/hr)")</span></span>
<span><span class="co">#&gt;         tcl &lt;- c(5.51439905878865, 8.41044546236311, 10.899462850803)</span></span>
<span><span class="co">#&gt;         label("Cl (L/hr)")</span></span>
<span><span class="co">#&gt;         tv &lt;- c(7.94567233496473, 10.5377244826318, 13.1050053785005)</span></span>
<span><span class="co">#&gt;         label("V (L)")</span></span>
<span><span class="co">#&gt;         add.sd &lt;- c(0, 0.7)</span></span>
<span><span class="co">#&gt;         label("additive residual error (mg/L)")</span></span>
<span><span class="co">#&gt;         eta.ka ~ 0.6</span></span>
<span><span class="co">#&gt;         eta.cl ~ 0.3</span></span>
<span><span class="co">#&gt;         eta.v ~ 0.1</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     model({</span></span>
<span><span class="co">#&gt;         ka &lt;- exp(tka + eta.ka)</span></span>
<span><span class="co">#&gt;         cl &lt;- exp(tcl + eta.cl)</span></span>
<span><span class="co">#&gt;         vc &lt;- exp(tv + eta.v)</span></span>
<span><span class="co">#&gt;         d/dt(depot) &lt;- -ka * depot</span></span>
<span><span class="co">#&gt;         d/dt(center) &lt;- ka * depot - cl/vc * center</span></span>
<span><span class="co">#&gt;         cp &lt;- 1000 * center/vc</span></span>
<span><span class="co">#&gt;         cp ~ add(add.sd)</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_print.html" class="external-link">knit_print</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">prepared</span><span class="op">$</span><span class="va">nca</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;  Interval Start Interval End  N AUClast (hr*ng/mL) Cmax (ng/mL)</span></span>
<span><span class="co">#&gt;               0           24 12        74.6 [24.3]            .</span></span>
<span><span class="co">#&gt;               0          Inf 12                  .  8.65 [17.0]</span></span>
<span><span class="co">#&gt;           Tmax (hr) CL (based on AUClast) (mg/(hr*ng/mL))</span></span>
<span><span class="co">#&gt;                   .                           4.22 [23.0]</span></span>
<span><span class="co">#&gt;  1.14 [0.630, 3.55]                                     .</span></span>
<span><span class="co">#&gt;  Vss (based on AUClast) (mg/(ng/mL)) Half-life (hr) AUCinf,obs (hr*ng/mL)</span></span>
<span><span class="co">#&gt;                          25.0 [18.5]              .                     .</span></span>
<span><span class="co">#&gt;                                    .    8.18 [2.12]            115 [28.4]</span></span>
<span><span class="co">#&gt;  Cmax (dose-normalized) ((ng/mL)/mg)</span></span>
<span><span class="co">#&gt;                                    .</span></span>
<span><span class="co">#&gt;                        0.0274 [18.1]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Caption: AUClast, Cmax, CL (based on AUClast), Vss (based on AUClast), AUCinf,obs, Cmax (dose-normalized): geometric mean and geometric coefficient of variation; Tmax: median and range; Half-life: arithmetic mean and standard deviation; N: number of subjects</span></span></code></pre></div>
<p>From the updated model, you can perform estimation on the new model
object, as with any other model that has been created for
<code>nlmixr2</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlmixr2.html" class="external-link">nlmixr</a></span><span class="op">(</span><span class="va">prepared</span>, data <span class="op">=</span> <span class="va">theo_sd</span>, est <span class="op">=</span> <span class="st">"focei"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>print <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; → loading into <span style="color: #0000BB;">symengine</span> environment...</span></span>
<span><span class="co">#&gt; → pruning branches (`if`/`else`) of full model...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → calculate jacobian</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → calculate sensitivities</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → calculate ∂(f)/∂(η)</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → calculate ∂(R²)/∂(η)</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in inner model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in inner model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → compiling inner model...</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in FD model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in FD model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → compiling EBE model...</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → compiling events FD model...</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; rxode2 3.0.4.9000 using 2 threads (see ?getRxThreads)</span></span>
<span><span class="co">#&gt;   no cache: create with `rxCreateCache()`</span></span>
<span><span class="co">#&gt; calculating covariance matrix</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00 </span></span>
<span><span class="co">#&gt; done</span></span>
<span><span class="co">#&gt; → Calculating residuals/tables</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → compress origData in nlmixr2 object, save 5952</span></span>
<span><span class="co">#&gt; → compress parHistData in nlmixr2 object, save 10632</span></span>
<span></span>
<span><span class="va">fit</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── </span><span style="color: #0000BB; font-weight: bold;">nlmix</span><span style="color: #BB0000; font-weight: bold;">r²</span><span style="font-weight: bold;"> </span><span style="color: #BBBB00; font-weight: bold;">FOCE</span><span style="color: #BB0000; font-weight: bold;">i</span> (outer: nlminb) ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           OBJF      AIC      BIC Log-likelihood Condition#(Cov) Condition#(Cor)</span></span>
<span><span class="co">#&gt; FOCEi 116.9548 373.5546 393.7342      -179.7773         66.5244        12.97786</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Time (sec </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$time</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            setup optimize covariance table compress  other</span></span>
<span><span class="co">#&gt; elapsed 0.030299   0.5161   0.516101 0.074    0.188 7.5535</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Population Parameters (</span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$parFixed</span><span style="font-weight: bold;"> or </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$parFixedDf</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                             <span style="font-weight: bold;">Parameter</span>  <span style="font-weight: bold;">Est.</span>     <span style="font-weight: bold;">SE</span>  <span style="font-weight: bold;">%RSE</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tka</span>                         Ka (1/hr) 0.469  0.224  47.6</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tcl</span>                         Cl (L/hr)  7.92 0.0929  1.17</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tv</span>                              V (L)  10.4 0.0602 0.581</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">add.sd</span> additive residual error (mg/L) 0.697             </span></span>
<span><span class="co">#&gt;              <span style="font-weight: bold;">Back-transformed(95%CI)</span> <span style="font-weight: bold;">BSV(CV%)</span> <span style="font-weight: bold;">Shrink(SD)%</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tka</span>                 1.6 (1.03, 2.48)     68.0    <span style="color: #BB0000; font-weight: bold;">-0.666%</span> </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tcl</span>     2.75e+03 (2.29e+03, 3.3e+03)     26.1      3.95% </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">tv</span>     3.19e+04 (2.83e+04, 3.59e+04)     15.4      14.5% </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">add.sd</span>                         0.697                     </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;   Covariance Type (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$covMethod</span>): <span style="font-weight: bold;">r,s</span></span></span>
<span><span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span></span>
<span><span class="co">#&gt;   Full BSV covariance (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$omega</span>) or correlation (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$omegaR</span>; diagonals=SDs) </span></span>
<span><span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in <span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$shrink</span> </span></span>
<span><span class="co">#&gt;   Information about run found (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$runInfo</span>):</span></span>
<span><span class="co">#&gt;    • gradient problems with initial estimate and covariance; see $scaleInfo </span></span>
<span><span class="co">#&gt;    • last objective function was not at minimum, possible problems in optimization </span></span>
<span><span class="co">#&gt;    • ETAs were reset to zero during optimization; (Can control by foceiControl(resetEtaP=.)) </span></span>
<span><span class="co">#&gt;    • initial ETAs were nudged; (can control by foceiControl(etaNudge=., etaNudge2=)) </span></span>
<span><span class="co">#&gt;   Censoring (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$censInformation</span>): No censoring</span></span>
<span><span class="co">#&gt;   Minimization message (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$message</span>):  </span></span>
<span><span class="co">#&gt;     false convergence (8) </span></span>
<span><span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span></span>
<span><span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span></span>
<span><span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span></span>
<span><span class="co">#&gt;   You may also try a good derivative free optimization:</span></span>
<span><span class="co">#&gt;     nlmixr2(...,control=list(outerOpt="bobyqa"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Fit Data (object </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="font-weight: bold;"> is a modified </span><span style="color: #0000BB; font-weight: bold;">tibble</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 132 × 22</span></span></span>
<span><span class="co">#&gt;   ID     TIME    DV  PRED    RES   WRES IPRED   IRES  IWRES CPRED   CRES  CWRES</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1      0     0.74  0     0.74   1.06   0     0.74   1.06   0     0.74   1.06 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1      0.25  2.84  3.27 -<span style="color: #BB0000;">0.432</span> -<span style="color: #BB0000;">0.234</span>  3.84 -<span style="color: #BB0000;">1.00</span>  -<span style="color: #BB0000;">1.44</span>   3.23 -<span style="color: #BB0000;">0.389</span> -<span style="color: #BB0000;">0.185</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1      0.57  6.57  5.84  0.730  0.297  6.78 -<span style="color: #BB0000;">0.215</span> -<span style="color: #BB0000;">0.308</span>  5.78  0.786  0.287</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 129 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10 more variables: eta.ka &lt;dbl&gt;, eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, depot &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   center &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, vc &lt;dbl&gt;, tad &lt;dbl&gt;, dosenum &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="give-pknca-a-different-dataset-or-a-completed-nca-analysis">Give PKNCA a different dataset or a completed NCA analysis<a class="anchor" aria-label="anchor" href="#give-pknca-a-different-dataset-or-a-completed-nca-analysis"></a>
</h2>
<p>To get the initial estimate, <code>babelmixr2</code> automatically
converts your modeling dataset to the format the is needed for PKNCA,
and the NCA is automatically performed using all the data.</p>
<p>In some cases (e.g. studies with sparse data), NCA may not be
feasible. In those cases, you can provide a different dataset to PKNCA
compared to the full modeling dataset. Usually, the simplest method is
to provide single-dose, dense-sampling, dose-ranging data (i.e. the
single-ascending dose portion of the first-in-human study) to be
estimated.</p>
<p>To do this, give your data to PKNCA using the <code>ncaData</code>
argument to <code><a href="../reference/pkncaControl.html">pkncaControl()</a></code> as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Choose a subset of the full dataset for NCA</span></span>
<span><span class="va">dNCA</span> <span class="op">&lt;-</span> <span class="va">theo_sd</span><span class="op">[</span><span class="va">theo_sd</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;=</span> <span class="fl">6</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">preparedNcaData</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/nlmixr2/reference/nlmixr2.html" class="external-link">nlmixr2</a></span><span class="op">(</span></span>
<span>    <span class="va">one.compartment</span>,</span>
<span>    data <span class="op">=</span> <span class="va">theo_sd</span>,</span>
<span>    est <span class="op">=</span> <span class="st">"pknca"</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="../reference/pkncaControl.html">pkncaControl</a></span><span class="op">(</span>concu <span class="op">=</span> <span class="st">"ng/mL"</span>, doseu <span class="op">=</span> <span class="st">"mg"</span>, timeu <span class="op">=</span> <span class="st">"hr"</span>, volumeu <span class="op">=</span> <span class="st">"L"</span>, ncaData <span class="op">=</span> <span class="va">dNCA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> parameter labels from comments are typically ignored in non-interactive mode</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Need to run with the source intact to parse comments</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate (0.929027077269762) and upper/lower bound (-3.50655789731998 to 3.32136703319919) of `tka`</span></span>
<span><span class="co">#&gt; → significant model change detected</span></span>
<span><span class="co">#&gt; → removed from model: '$getSplitModel'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate (8.3955404628088) and upper/lower bound (5.85241523541802 to 10.7637056987378) of `tcl`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate (10.5377244826318) and upper/lower bound (7.94370069836702 to 13.1024358787022) of `tv`</span></span>
<span></span>
<span><span class="va">preparedNcaData</span><span class="op">$</span><span class="va">ui</span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">rxode2-based free-form 2-cmt ODE model</span> <span style="color: #00BBBB;">──────────────────────────────────────</span> </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Initalization:</span> ──  </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Fixed Effects</span> (<span style="color: #0000BB; font-weight: bold;">$theta</span>): </span></span>
<span><span class="co">#&gt;        tka        tcl         tv     add.sd </span></span>
<span><span class="co">#&gt;  0.9290271  8.3955405 10.5377245  0.7000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Omega</span> (<span style="color: #0000BB; font-weight: bold;">$omega</span>): </span></span>
<span><span class="co">#&gt;        eta.ka eta.cl eta.v</span></span>
<span><span class="co">#&gt; eta.ka    0.6    0.0   0.0</span></span>
<span><span class="co">#&gt; eta.cl    0.0    0.3   0.0</span></span>
<span><span class="co">#&gt; eta.v     0.0    0.0   0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; States</span> (<span style="color: #0000BB; font-weight: bold;">$state</span> or <span style="color: #0000BB; font-weight: bold;">$stateDf</span>): </span></span>
<span><span class="co">#&gt;   Compartment Number Compartment Name</span></span>
<span><span class="co">#&gt; 1                  1            depot</span></span>
<span><span class="co">#&gt; 2                  2           center</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">μ-referencing (</span><span style="color: #0000BB; font-weight: bold;">$muRefTable</span><span style="font-weight: bold;">):</span> ──  </span></span>
<span><span class="co">#&gt;   theta    eta level</span></span>
<span><span class="co">#&gt; 1   tka eta.ka    id</span></span>
<span><span class="co">#&gt; 2   tcl eta.cl    id</span></span>
<span><span class="co">#&gt; 3    tv  eta.v    id</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Model (Normalized Syntax):</span> ── </span></span>
<span><span class="co">#&gt; function() {</span></span>
<span><span class="co">#&gt;     ini({</span></span>
<span><span class="co">#&gt;         tka &lt;- c(-3.50655789731998, 0.929027077269762, 3.32136703319919)</span></span>
<span><span class="co">#&gt;         label("Ka (1/hr)")</span></span>
<span><span class="co">#&gt;         tcl &lt;- c(5.85241523541802, 8.3955404628088, 10.7637056987378)</span></span>
<span><span class="co">#&gt;         label("Cl (L/hr)")</span></span>
<span><span class="co">#&gt;         tv &lt;- c(7.94370069836702, 10.5377244826318, 13.1024358787022)</span></span>
<span><span class="co">#&gt;         label("V (L)")</span></span>
<span><span class="co">#&gt;         add.sd &lt;- c(0, 0.7)</span></span>
<span><span class="co">#&gt;         label("additive residual error (mg/L)")</span></span>
<span><span class="co">#&gt;         eta.ka ~ 0.6</span></span>
<span><span class="co">#&gt;         eta.cl ~ 0.3</span></span>
<span><span class="co">#&gt;         eta.v ~ 0.1</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     model({</span></span>
<span><span class="co">#&gt;         ka &lt;- exp(tka + eta.ka)</span></span>
<span><span class="co">#&gt;         cl &lt;- exp(tcl + eta.cl)</span></span>
<span><span class="co">#&gt;         vc &lt;- exp(tv + eta.v)</span></span>
<span><span class="co">#&gt;         d/dt(depot) &lt;- -ka * depot</span></span>
<span><span class="co">#&gt;         d/dt(center) &lt;- ka * depot - cl/vc * center</span></span>
<span><span class="co">#&gt;         cp &lt;- 1000 * center/vc</span></span>
<span><span class="co">#&gt;         cp ~ add(add.sd)</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>The initial estimates are now based on NCA calculated from the
<code>dNCA</code> dataset rather than the full <code>theo_sd</code>
dataset.</p>
<p>If you already have NCA results calculated by PKNCA with the required
parameters (“tmax”, “cmax.dn”, and “cllast”), you can provide those
instead using the <code>pkncaControl(ncaResults)</code> argument.</p>
</div>
<div class="section level2">
<h2 id="model-requirements">Model requirements<a class="anchor" aria-label="anchor" href="#model-requirements"></a>
</h2>
<p>To update the initial estimates, the model must have parameters in
the <code><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model()</a></code> block with the names that are expected by
<code>est = "pknca"</code>. The expected names are:</p>
<ul>
<li><code>ka</code></li>
<li><code>vc</code></li>
<li><code>cl</code></li>
<li><code>vp</code></li>
<li><code>vp2</code></li>
<li><code>q</code></li>
<li><code>q2</code></li>
</ul>
<p>Any of those parameter names that are found in the
<code><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model()</a></code> block will be automatically traced back to the
initial conditions (<code><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini()</a></code> block), and the parameter values
will be updated. If the parameter is estimated on the log scale, the
updated parameter value will automatically be converted to the log
scale.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Fidler, Bill Denney.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
